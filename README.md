# Billion Roadmap Telegram Bot

This project is a tiny Telegram bot written in Go. It sends two messages every day using content generated by OpenAI. The delivery times are controlled by the `LUNCH_TIME` and `BRIEF_TIME` environment variables (defaults `13:00` and `20:00`):

* **13:00 MSK** – Lunch Idea Plan
* **20:00 MSK** – Daily Billion Brief (юг МО, Бутово/Щербинка/Подольск/Воскресенск)

The bot can be deployed on any always‑online environment such as Railway, Fly.io or a VPS.

## Commands

- `/chat <message>` – ask the bot any question and get a reply from OpenAI.
- `/ping` – health check that replies `pong`.
- `/model [name]` – show or change the model used for generation (default `gpt-4o`).
- `/lunch` – immediately request a lunch idea digest.
- `/brief` – immediately request the daily brief.

## Requirements

* Go 1.24+
* Telegram bot token (`TELEGRAM_TOKEN`)
* Destination chat ID (`CHAT_ID`)
* OpenAI API key (`OPENAI_API_KEY`)
* OpenAI model name (`OPENAI_MODEL`, optional, defaults to `gpt-4o`)
* Lunch idea time (`LUNCH_TIME`, optional, defaults to `13:00`)
* Brief message time (`BRIEF_TIME`, optional, defaults to `20:00`)

## Adding the bot to channels and groups

1. Invite the bot to the channel or group where it should post.
2. Promote it so that it can send messages (administrator in channels).
3. Send a test message in that chat and open:

   ```
   https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates
   ```

   The JSON response includes a `chat.id` field – this is the numeric channel ID.
4. Set the `CHAT_ID` environment variable to this value when starting the bot.

## Running locally

Set the required environment variables and start the bot:

```sh
export TELEGRAM_TOKEN=your_telegram_token
export CHAT_ID=123456789
export OPENAI_API_KEY=your_openai_key
export LUNCH_TIME=13:00
export BRIEF_TIME=20:00

go run main.go
```

Once started, the scheduler will automatically send the two daily messages at the specified times.
On startup the bot also posts "джарвис в сети, обновление произошло успешно" to confirm a successful deployment.
Each request to OpenAI uses a 40-second timeout to avoid hanging jobs.
Before submitting a pull request, run `gofmt -w -s` to format the code and `go vet ./...` to check for issues. Install the linter with `go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.63.0` and then run `golangci-lint run`.

## Deploying on a server

1. Install Go on your server.
2. Clone this repository.
3. Set the environment variables shown above.
4. Build the binary with `go build -o bot`.
5. Run `./bot` or configure a process manager like `systemd`.


## Docker

Build the image for the current platform:

```sh
docker build -t telegram-bot .
```

To build and push a multi-platform image (linux/amd64 and linux/arm64) using
`buildx`:

```sh
docker buildx build --platform linux/amd64,linux/arm64 \
  -t your_dockerhub_user/telegram-bot:latest --push .
```

Run the container:

```sh
docker run -e TELEGRAM_TOKEN=your_token -e CHAT_ID=your_chat_id -e OPENAI_API_KEY=your_api_key \
  -e LUNCH_TIME=13:00 -e BRIEF_TIME=20:00 telegram-bot
```

You can also run the bot using `docker-compose`. Copy `.env.example` to `.env`, fill in the required values, then start the service. The `DOCKERHUB_USER` variable in `.env` defines the Docker Hub account used in `docker-compose.yml`:

```sh
cp .env.example .env
docker-compose up -d
```

## GitHub Actions Deployment

This repository includes a GitHub Actions workflow that automatically builds and
deploys the Docker image on every push to the `main` branch. It uses Docker
Buildx to create a multi-architecture image. The workflow performs the following
steps:

1. Check out the repository and compile the Go binary.
2. Use Docker Buildx to create and push a multi-platform image
   (linux/amd64 and linux/arm64) to Docker Hub.
3. Connect to the VPS via SSH and restart the container using
   `docker-compose`.

Make sure to configure all required secrets for the workflow in your repository
settings:

* `DOCKERHUB_USER` and `DOCKERHUB_TOKEN` for publishing the image.
* `VPS_SSH_KEY`, `VPS_USER` and `VPS_HOST` for connecting to the server.
* `TELEGRAM_TOKEN`, `OPENAI_API_KEY`, `CHAT_ID` and optionally `OPENAI_MODEL` to
  populate the `.env` file during deployment.

After the deployment job finishes, log into the VPS and run `docker ps` to
verify that the container is up and running.

## Troubleshooting

The Docker container will exit immediately if the required environment variables are not set:

* `TELEGRAM_TOKEN`
* `CHAT_ID` (numeric ID)
* `OPENAI_API_KEY`

Ensure these values are provided either in your environment or in a `.env` file. A valid `.env` might look like:

```ini
TELEGRAM_TOKEN=123456:ABC-DEF
CHAT_ID=123456789
OPENAI_API_KEY=sk-xxxxxxxx
OPENAI_MODEL=gpt-4o
LUNCH_TIME=13:00
BRIEF_TIME=20:00
```

If the container fails to start, inspect the logs with `docker logs <container>` to see the error messages.

## License

Released under the [MIT License](LICENSE).
